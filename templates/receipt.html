{% extends "base.html" %}

{% block title %}Receipt #{{ payment.receipt_number }}{% endblock %}

{% block extra_css %}
<style>
    /* A5 size styling */
    body {
        background-color: #f8f9fa;
        font-family: Arial, sans-serif;
    }
    
    .receipt-container {
        width: 148mm;
        min-height: 210mm;
        padding: 10mm;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    
    /* Header Styles */
    .receipt-header {
        text-align: center;
        margin-bottom: 8mm;
    }
    .receipt-logo {
        height: 20mm;
        margin-bottom: 3mm;
    }
    .receipt-title {
        font-size: 14pt;
        font-weight: bold;
        margin-bottom: 1mm;
    }
    .receipt-subtitle {
        font-size: 10pt;
        color: #666;
    }
    
    /* Details Section */
    .receipt-details {
        display: flex;
        justify-content: space-between;
        font-size: 9pt;
        margin-bottom: 8mm;
    }
    
    /* Table Styles */
    .receipt-table {
        width: 100%;
        border-collapse: collapse;
        margin: 5mm 0;
        font-size: 9pt;
    }
    .receipt-table th, 
    .receipt-table td {
        padding: 3mm 2mm;
        border: 0.5pt solid #ddd;
    }
    .receipt-table th {
        background-color: #f5f5f5;
        text-align: left;
    }
    .text-right {
        text-align: right;
    }
    .balance-row {
        font-weight: bold;
        background-color: #fff2f2;
    }
    
    /* Verification Section */
    .qr-code-container {
        width: 35mm;
        margin: 0 auto;
    }
    .signature-area {
        margin-top: 8mm;
        text-align: right;
    }
    .signature-line {
        border-top: 0.5pt solid #000;
        width: 50mm;
        display: inline-block;
        margin-top: 10mm;
    }
    
    /* Footer */
    .receipt-footer {
        font-size: 8pt;
        color: #666;
        text-align: center;
        margin-top: 5mm;
    }

    /* Print Specific Styles */
    @media print {
        body {
            background: white;
        }
        .receipt-container {
            width: 148mm;
            height: 210mm;
            margin: 0;
            padding: 10mm;
            box-shadow: none;
        }
        .no-print {
            display: none !important;
        }
        .receipt-table {
            page-break-inside: avoid;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="receipt-container">
    <!-- Header Section -->
    <div class="receipt-header">
        {% if logo_base64 %}
        <img src="data:image/png;base64,{{ logo_base64 }}" class="receipt-logo" alt="School Logo">
        {% endif %}
        <div class="receipt-title">ST PAUL RONGO DAY SECONDARY SCHOOL</div>
        <div class="receipt-subtitle">SCHOOL FEES PAYMENT RECEIPT</div>
    </div>
    
    <!-- Transaction Details -->
    <div class="receipt-details">
        <div>
            <strong>Receipt No:</strong> {{ payment.receipt_number }}<br>
            <strong>Date:</strong> {{ payment.payment_date.strftime('%d/%m/%Y') }}<br>
            <strong>Time:</strong> {{ current_time.split(' ')[1] }}
        </div>
        <div class="text-right">
            <strong>Student:</strong> {{ payment.student_name }}<br>
            <strong>Adm No:</strong> {{ payment.admission_no }}<br>
            <strong>Form:</strong> {{ payment.form }}
        </div>
    </div>
    
    <!-- Payment Breakdown -->
    <table class="receipt-table">
        <thead>
            <tr>
                <th>Description</th>
                <th class="text-right">Amount (KSh)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Payment for {{ payment.term_name }}</td>
                <td class="text-right">{{ "KSh{:,.2f}".format(payment.amount_paid) }}</td>
            </tr>
            <tr>
                <td class="text-right"><strong>Total Paid:</strong></td>
                <td class="text-right"><strong>{{ "KSh{:,.2f}".format(payment.amount_paid) }}</strong></td>
            </tr>
            <tr class="balance-row">
                <td class="text-right"><strong>Balance:</strong></td>
                <td class="text-right"><strong>{{ "KSh{:,.2f}".format(outstanding_balance) }}</strong></td>
            </tr>
        </tbody>
    </table>
    
    <!-- Verification Section -->
    <div class="row">
        <div class="col-6 text-center">
            <div class="qr-code-container">
                <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" style="width: 100%;">
                <div style="font-size: 8pt; margin-top: 1mm;">Scan to verify</div>
            </div>
        </div>
        <div class="col-6">
            <div class="signature-area">
                <div class="signature-line"></div>
                <div style="font-size: 9pt;">Authorized Signatory</div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="receipt-footer">
        This is an official computer-generated receipt from ST PAUL RONGO<br>
        {{ current_time.split(' ')[0] }} | Thank you for your payment
    </div>
</div>

<!-- Print Controls (Hidden when printing) -->
<div class="text-center no-print mt-3">
    <button onclick="window.print()" class="btn btn-primary">
        <i class="bi bi-printer"></i> Print Receipt
    </button>
    <a href="{{ url_for('view_payments') }}" class="btn btn-outline-secondary ms-2">
        <i class="bi bi-arrow-left"></i> Back to Payments
    </a>
</div>

<script>
    // Auto-print when page loads (optional)
    window.onload = function() {
        setTimeout(function() {
            window.print();
        }, 500);
    };
</script>
{% endblock %}
