{% extends "base.html" %}

{% block title %}Receipt #{{ payment.receipt_number }}{% endblock %}

{% block extra_css %}
<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .receipt-container, .receipt-container * {
            visibility: visible;
        }
        .receipt-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            padding: 20px;
            margin: 0;
            box-shadow: none;
            background-color: white;
        }
        .no-print {
            display: none !important;
        }
        .table {
            page-break-inside: avoid;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 no-print">
    <h2><i class="bi bi-receipt"></i> Payment Receipt</h2>
    <div>
        <button onclick="window.print()" class="btn btn-primary me-2">
            <i class="bi bi-printer"></i> Print Receipt
        </button>
        <a href="{{ url_for('generate_receipt_pdf', payment_id=payment.id) }}" class="btn btn-success me-2">
            <i class="bi bi-download"></i> Download PDF
        </a>
        <a href="{{ url_for('view_payments') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Payments
        </a>
    </div>
</div>

<div class="receipt-container">
    <div class="text-center mb-4">
        {% if logo_base64 %}
        <img src="data:image/png;base64,{{ logo_base64 }}" alt="School Logo" style="max-height: 80px; margin-bottom: 15px;">
        {% endif %}
        <h3>SCHOOL FEES PAYMENT RECEIPT</h3>
        <p class="text-muted">Official Receipt</p>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <h5>School Information</h5>
            <p>
                <strong>Example High School</strong><br>
                123 Education Road<br>
                Nairobi, Kenya<br>
                Phone: +254 700 123456<br>
                Email: info@examplehigh.edu
            </p>
        </div>
        <div class="col-md-6 text-end">
            <h5>Receipt Details</h5>
            <p>
                <strong>Receipt No:</strong> {{ payment.receipt_number }}<br>
                <strong>Date:</strong> {{ payment.payment_date.strftime('%d/%m/%Y') }}<br>
                <strong>Time:</strong> {{ current_time.split(' ')[1] }}
            </p>
        </div>
    </div>
    
    <div class="mb-4">
        <h5>Student Information</h5>
        <p>
            <strong>Name:</strong> {{ payment.student_name }}<br>
            <strong>Admission No:</strong> {{ payment.admission_no }}<br>
            <strong>Form:</strong> {{ payment.form }}
        </p>
    </div>
    
    <table class="table table-bordered mb-4">
        <thead class="table-light">
            <tr>
                <th>Description</th>
                <th>Amount (KSh)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Payment for {{ payment.term_name }}</td>
                <td class="text-end">{{ "KSh{:,.2f}".format(payment.amount_paid) }}</td>
            </tr>
            <tr>
                <td class="text-end"><strong>Total Paid:</strong></td>
                <td class="text-end"><strong>{{ "KSh{:,.2f}".format(payment.amount_paid) }}</strong></td>
            </tr>
            <tr>
                <td class="text-end"><strong>Outstanding Balance:</strong></td>
                <td class="text-end"><strong>{{ "KSh{:,.2f}".format(outstanding_balance) }}</strong></td>
            </tr>
        </tbody>
    </table>
    
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="border p-3 text-center">
                <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" style="width: 120px;">
                <p class="mt-2 mb-0"><small>Scan to verify receipt</small></p>
            </div>
        </div>
        <div class="col-md-6 text-end">
            <div class="mt-5 pt-3">
                <p class="border-top pt-3">
                    <strong>Authorized Signatory</strong><br>
                    <small>School Bursar</small>
                </p>
            </div>
        </div>
    </div>
    
    <div class="text-center mt-4 text-muted">
        <small>This is an official receipt from Example High School. Thank you for your payment.</small>
    </div>
</div>

<div class="text-center mt-4 no-print">
    <button onclick="window.print()" class="btn btn-primary">
        <i class="bi bi-printer"></i> Print Receipt
    </button>
</div>

{% endblock %}
