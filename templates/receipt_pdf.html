{% extends "base.html" %}

{% block title %}Receipt #{{ payment.receipt_number }}{% endblock %}

{% block extra_css %}
<style>
    /* Compact styling */
    .receipt-container {
        max-width: 600px;
        padding: 15px;
    }
    .receipt-header {
        margin-bottom: 15px;
    }
    .receipt-details {
        font-size: 0.9rem;
    }
    .receipt-table {
        font-size: 0.85rem;
    }
    .receipt-table th, 
    .receipt-table td {
        padding: 5px 8px;
    }
    .receipt-footer {
        margin-top: 15px;
        font-size: 0.8rem;
    }
    .qr-code-container {
        width: 100px;
        margin: 0 auto;
    }
    
    @media print {
        body * {
            visibility: hidden;
        }
        .receipt-container, .receipt-container * {
            visibility: visible;
        }
        .receipt-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            padding: 10px;
            margin: 0;
            box-shadow: none;
            font-size: 12px;
        }
        .no-print {
            display: none !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="receipt-container mx-auto">
    <!-- Compact Header -->
    <div class="text-center receipt-header">
        {% if logo_base64 %}
        <img src="data:image/png;base64,{{ logo_base64 }}" alt="School Logo" style="height: 50px; margin-bottom: 5px;">
        {% endif %}
        <h4 style="margin-bottom: 5px;">SCHOOL FEES PAYMENT RECEIPT</h4>
        <small class="text-muted">Official Receipt</small>
    </div>
    
    <!-- Compact Details -->
    <div class="row receipt-details">
        <div class="col-6">
            <strong>Receipt No:</strong> {{ payment.receipt_number }}<br>
            <strong>Date:</strong> {{ payment.payment_date.strftime('%d/%m/%Y') }}<br>
            <strong>Time:</strong> {{ current_time.split(' ')[1] }}
        </div>
        <div class="col-6 text-end">
            <strong>Student:</strong> {{ payment.student_name }}<br>
            <strong>Adm No:</strong> {{ payment.admission_no }}<br>
            <strong>Form:</strong> {{ payment.form }}
        </div>
    </div>
    
    <!-- Compact Table -->
    <table class="table table-bordered receipt-table mt-3">
        <thead>
            <tr>
                <th>Description</th>
                <th class="text-end">Amount (KSh)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Payment for {{ payment.term_name }}</td>
                <td class="text-end">{{ "KSh{:,.2f}".format(payment.amount_paid) }}</td>
            </tr>
            <tr>
                <td class="text-end"><strong>Total Paid:</strong></td>
                <td class="text-end"><strong>{{ "KSh{:,.2f}".format(payment.amount_paid) }}</strong></td>
            </tr>
            <tr>
                <td class="text-end"><strong>Balance:</strong></td>
                <td class="text-end"><strong>{{ "KSh{:,.2f}".format(outstanding_balance) }}</strong></td>
            </tr>
        </tbody>
    </table>
    
    <!-- Compact Footer -->
    <div class="row mt-3">
        <div class="col-6 text-center">
            <div class="qr-code-container">
                <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" style="width: 100%;">
                <small>Scan to verify</small>
            </div>
        </div>
        <div class="col-6 text-end">
            <div class="border-top pt-2">
                <strong>Authorized Signatory</strong><br>
                <small>School Bursar</small>
            </div>
        </div>
    </div>
    
    <div class="text-center receipt-footer text-muted mt-2">
        <small>Official receipt from Example High School</small>
    </div>
</div>

<!-- Print Button -->
<div class="text-center mt-3 no-print">
    <button onclick="window.print()" class="btn btn-sm btn-primary">
        <i class="bi bi-printer"></i> Print Receipt
    </button>
    <a href="{{ url_for('view_payments') }}" class="btn btn-sm btn-outline-secondary ms-2">
        <i class="bi bi-arrow-left"></i> Back
    </a>
</div>
{% endblock %}
